generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id          String   @id @default(uuid())
  name        String
  email       String   @unique
  password    String
  points      Int      @default(0)
  currentRank Int?
  lastRank    Int?
  role        Role     @default(USER)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relation
  transactions Transaction[] @relation("UserTransactions")
  handled      Transaction[] @relation("PetugasTransactions")
}

model Transaction {
  id        String  @id @default(uuid())
  user      User    @relation("UserTransactions", fields: [userId], references: [id])
  userId    String
  petugas   User?   @relation("PetugasTransactions", fields: [petugasId], references: [id])
  petugasId String?

  status    Status
  createdAt DateTime @default(now())

  signature String

  items TransactionItem[]
}

model TransactionItem {
  id            String      @id @default(uuid())
  transaction   Transaction @relation(fields: [transactionId], references: [id])
  transactionId String

  trashType TrashType
  weight    Float
  points    Int
}

enum Role {
  USER
  PETUGAS
  ADMIN
}

enum TrashType {
  PLASTIC
  PAPER
  METAL
  ORGANIC
  OTHER
}

enum Status {
  APPROVED
  REJECTED
}
